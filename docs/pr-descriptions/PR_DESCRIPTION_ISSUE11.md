# TOPページ（ランディングページ）のデザインと構築

## 概要

初見のユーザーに対して、リザルト画像をアップするだけでシナリオコードを共有できるという価値を伝え、メイン機能へ誘導するランディングページを実装しました。

## 主な変更内容

### 1. ランディングページの実装 (`app/page.tsx`)

#### サーバーコンポーネントへの変更
- クライアントコンポーネントからサーバーコンポーネントに変更
- サーバーサイドでSupabaseからデータを取得し、パフォーマンスを向上

#### ヒーローセクション
- キャッチコピー「リザルト画像をアップするだけ シナリオコードを共有」を表示
- オレンジからイエローへのグラデーション背景
- 2つのCTAボタン:
  - 「AI解析を試す」: `/analyze` へのリンク
  - 「最新シナリオを見る」: ページ内の最新シナリオセクションへのアンカーリンク

#### 3ステップガイド
- 使い方を3ステップで説明:
  1. スクリーンショットを撮る
  2. AIが自動解析
  3. みんなで共有
- レスポンシブ対応のグリッドレイアウト（PC: 3列、モバイル: 1列）

#### 最新シナリオのプレビュー
- `scenarios` テーブルから最新6件を取得
- `scenario_weapons` テーブルから武器情報を取得
- `ScenarioCard` コンポーネントを使用して表示
- 空状態の表示（シナリオが存在しない場合）
- 「すべて見る」リンクで一覧ページへ導線を確保

### 2. データ取得ロジック (`getLatestScenarios`)

#### Supabaseクエリの実装
- `scenarios` テーブルから最新6件を取得（`created_at` 降順）
- `scenario_weapons` テーブルから武器情報を取得
- `m_stages` と `m_weapons` テーブルとJOINしてマスタ情報を取得

#### エラーハンドリングとバグ修正
- **Bug Fix 1**: `scenarioCodes` が空の場合のガード句を追加
  - シナリオが存在しない場合、早期リターンして `scenario_weapons` クエリをスキップ
- **Bug Fix 2**: `scenario_weapons` クエリのエラーハンドリングを追加
  - 武器情報取得エラーをログに記録（シナリオ情報は返す）
- **Bug Fix 3**: `scenario_weapons` クエリに `.limit(limit * 4)` を追加
  - 各シナリオに最大4つの武器があるため、`limit * 4` で制限

### 3. テストの実装 (`app/__tests__/page.test.tsx`)

#### テスト環境の構築
- Supabaseサーバークライアントのモック
- Next.jsの `cookies` APIのモック（非同期対応）
- Next.jsの `Link` コンポーネントのモック
- `lucide-react` アイコンのモック

#### テストケース
- ヒーローセクションのレンダリング確認
- CTAボタンの表示とリンク確認
- 3ステップガイドの表示確認
- 最新シナリオセクションの表示確認
- 空状態の表示確認
- データ取得ロジックの確認（Supabaseクエリの呼び出し確認）

#### モックの実装
- `createMockQueryBuilder` 関数でSupabaseクエリビルダーをモック
- `scenarios` と `scenario_weapons` テーブル用の別々のクエリビルダーを用意
- `.limit()` の呼び出しを検証するアサーションを追加

## UI/UXの特徴

- **ダークテーマ**: グレー基調（`bg-gray-900`, `bg-gray-800`）で目に優しい
- **グラデーション背景**: ヒーローセクションにオレンジからイエローへのグラデーション
- **レスポンシブデザイン**: 
  - PC: 3列グリッド、大きなフォントサイズ
  - タブレット: 2列グリッド
  - モバイル: 1列、縦並びレイアウト
- **視覚的フィードバック**: ホバー時のトランジション効果
- **CTAボタンの最適化**: 目立つデザインでクリック率を最大化

## 技術的な詳細

### サーバーコンポーネントの利点
- データ取得をサーバーサイドで実行し、初期ロード時間を短縮
- クライアント側のJavaScriptバンドルサイズを削減
- SEOに有利

### Supabaseクエリの最適化
- `inner` JOINを使用して必要なデータのみ取得
- `.limit()` で取得件数を制限
- エラーハンドリングで堅牢性を向上

### 型安全性
- TypeScriptの型定義を活用
- `ScenarioListItem` と `Weapon` インターフェースを定義

## テスト結果

すべてのテストが成功:
- ✅ ヒーローセクションのレンダリング
- ✅ CTAボタンの表示とリンク
- ✅ 3ステップガイドの表示
- ✅ 最新シナリオセクションの表示
- ✅ 空状態の表示
- ✅ データ取得ロジックの検証

## 実施事項のチェックリスト

- [x] `app/page.tsx` のデザイン実装
- [x] 「AI解析を試す」ボタンからアップロードページへの導線確保
- [x] `scenarios` テーブルから最新データを取得し表示する簡易セクションの実装
- [x] レスポンシブ対応
- [x] テストの実装と修正

## 期待される動作

- ✅ PC/スマホ両方で「何ができるサイトか」が一目で理解できる
- ✅ 解析ページへのクリック率（CTR）を最大化する目立つデザイン
- ✅ 最新シナリオのプレビューでサイトの価値を視覚的に伝える

## 関連Issue

Closes #11

## 備考

- Next.js 16のサーバーコンポーネントを活用
- Supabaseの最新APIを使用
- エラーハンドリングとガード句で堅牢性を確保
- テストカバレッジを維持
