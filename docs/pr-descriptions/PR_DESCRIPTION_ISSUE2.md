# [DB] サーモンラン関連テーブルの構築とマスタデータのインポート

## 概要

Issue #2の対応として、サーモンラン関連のリレーショナルデータベースを構築し、マスタデータを準備しました。

## 実施内容

### 1. データベーステーブルの作成

以下の5つのテーブルを作成しました：

- **m_stages**: ステージマスタ（ID、名前、画像URL）
- **m_weapons**: 武器マスタ（ID、名前、アイコンURL、クマサン武器フラグ）
- **scenarios**: シナリオ情報（コード、投稿者ID、ステージID、キケン度、総金イクラ、総赤イクラ）
- **scenario_waves**: WAVE情報（WAVE番号、潮位、イベント、納品数、ノルマ、クリア成否）
- **scenario_weapons**: シナリオ武器情報（シナリオID、武器ID、表示順）

### 2. 外部キー制約とインデックスの設定

- 各テーブル間の外部キー制約を設定
- パフォーマンス向上のためのインデックスを追加
- `updated_at`カラムの自動更新トリガーを実装

### 3. Row Level Security (RLS) の設定

- すべてのテーブルでRLSを有効化
- **閲覧権限**: 全ユーザーが閲覧可能
- **作成権限**: 認証済みユーザーのみ作成可能
- **更新・削除権限**: シナリオの作成者のみ可能

### 4. マスタデータの準備

#### ステージマスタ（7種類）
- アラマキ砦
- ムニ・エール海洋発電所
- シェケナダム
- 難破船ドン・ブラコ
- すじこジャンクション跡
- トキシラズいぶし工房
- どんぴこ闘技場

#### 武器マスタ（81種類）
- 通常武器: 73種類（シューター、ローラー、チャージャー、スロッシャー、ブラスター、スピナー、マニューバー、シェルター、フデ、ストリンガー、ワイパー）
- クマサン印の武器: 8種類

### 5. 型定義の更新

`app/types/database.types.ts`に新しいテーブルの型定義を追加しました。

### 6. ドキュメントの追加

- `supabase/README.md`: SQLファイルの実行手順とテーブル構成の説明
- 便利なクエリ（テーブル一覧の取得方法など）を追加

## ファイル構成

```
supabase/
├── migrations/
│   ├── 001_create_tables.sql      # テーブル作成
│   ├── 002_enable_rls.sql         # RLS有効化とポリシー設定
│   └── 003_import_master_data.sql # マスタデータのインポート（JSONから読み込み）
├── seed/
│   ├── m_stages.json               # ステージマスタデータ
│   └── m_weapons.json              # 武器マスタデータ
└── README.md                       # 実行手順とドキュメント
```

## 実行手順

Supabase DashboardのSQL Editorで、以下の順序でSQLファイルを実行してください：

1. `001_create_tables.sql` - テーブル作成
2. `002_enable_rls.sql` - RLS有効化とポリシー設定
3. `003_import_master_data.sql` - マスタデータのインポート

## 参考資料

マスタデータの作成にあたり、以下のサイトを参考にしました：

- [Game8 - サーモンラン武器別の立ち回り](https://game8.jp/splatoon3/481356)
- [Gamepedia - サーモンラン全ブキのダメージ数一覧](https://gamepedia.jp/splatoon3/archives/15178)
- [WikiWiki - サーモンランブキ別立ち回り](https://wikiwiki.jp/splatoon3mix/%E3%82%B5%E3%83%BC%E3%83%A2%E3%83%B3%E3%83%A9%E3%83%B3/%E3%83%96%E3%82%AD%E5%88%A5%E7%AB%8B%E3%81%A1%E5%9B%9E%E3%82%8A/%E3%83%96%E3%82%AD%E5%88%A5%E7%AB%8B%E3%81%A1%E5%9B%9E%E3%82%8A%E5%80%8B%E5%88%A5%E8%A7%A3%E8%AA%AC)
- [WikiWiki - サーモンランステージ](https://wikiwiki.jp/splatoon3mix/%E3%82%B5%E3%83%BC%E3%83%A2%E3%83%B3%E3%83%A9%E3%83%B3/%E3%82%B9%E3%83%86%E3%83%BC%E3%82%B8)

## 注意事項

- 画像URLは著作権の観点から現時点では`null`として設定しています（将来の検討事項）
- マスタデータはJSONファイルから読み込む形式にしており、データの追加・修正が容易です
- `ON CONFLICT (name) DO NOTHING`を使用しているため、重複実行してもエラーになりません

## 期待される動作

- `scenarios`テーブルを介して、特定のWAVE情報や使用武器情報が正しくリレーションで取得できること
- 認証済みユーザーがシナリオを作成・更新・削除できること
- 未認証ユーザーでもシナリオを閲覧できること

## 関連Issue

- #2

